<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Web Source</title>
    <link type="text/css" rel="stylesheet" href="/static/global.css?v={{ get_file_sha('static/global.css') }}">
    {% if display_type == "no-background" %}
      <style>
        body, html {
            background: transparent !important;
        }
      </style>
    {% elif display_type == "only-background" %}
      <style>
        body > * {
          display: none !important;
        }
      </style>
    {% elif display_type == "logo-and-background" %}
      <style>
          body > *:not(.obs-event-logo) {
              display: none !important;
          }
      </style>
    {% endif %}

    <script type="application/json" id="initSettings">
      {% if data %}
      {
        "display": {{ display_type | tojson }},
        "data": {{ data | tojson }},
        "presentationBottomBar": {{ presentation_bottom_bar | default(None) | tojson }},
        "presentationSponsors": {{ presentation_sponsors | default(None) | tojson }}
      }
      {% else %}
        {
          "display": {{ display_type | tojson }},
          "ws": "/v1/rigs/{{ rig }}/views/scene-{{ scene }}/ws?display={{ display_type }}",
          "presentationBottomBar": {{ presentation_bottom_bar | default(None) | tojson }},
          "presentationSponsors": {{ presentation_sponsors | default(None) | tojson }}
        }
      {% endif %}
    </script>
    <script type="importmap">
      {
        "imports": {
          "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
        }
      }
    </script>
    <script type="module" src="/static/ws.js?v={{ get_file_sha('static/ws.js') }}"></script>
  </head>
  <body class="obs-body-default obs-body-scene-{{ scene }}" id="app">
    {% raw %}
    <template v-if="state">
      <Teleport to="head">
        <link type="text/css" rel="stylesheet" :href="`/static/branding/${event.branding}.css?v=${event.branding_sha}`">
      </Teleport>

      <div
           v-for="(screen, screen_no) in state.view.active_screens"
           :class="['obs-intermission-content', `onScreenNo-${screen_no}`, {'onCurrentScreen': currentScreenNumber == screen_no}]"
      >
      <!-- Event Logo -->
        <div v-if="screen.logo" :class="['obs-event-logo', {'obs-event-logo-thumbnail': display !== 'scene'}]">
          <img :src="event.logo_url" :alt="`${event.name} logo`">
          <div class="obs-event-title">
            {{ event.title }}
          </div>
        </div>

      <!-- Sponsor groups -->
        <div v-if="screen.type == 'sponsor-groups'"
            :class="['obs-intermission-sponsors', {'noLogo': !screen.logo, 'underLogo': screen.type == 'schedule'}]">
          <div v-for="(group, index) in screen.groups"
              :class="['obs-intermission-sponsor-group', group.classes]">
              <div class="obs-intermission-sponsor-group-title" v-if="group.name">{{ group.name }}</div>
              <div v-for="sponsor in group.sponsors" :class="['obs-intermission-sponsors-entry', sponsor.classes, group.sponsor_classes]">
                <img :src="sponsor.logo_url" :alt="sponsor.name">
              </div>
          </div>
        </div>

      <!-- Schedule -->
        <div :class="['obs-intermission-schedule', `obs-intermission-schedule-variant-${(state.current_state[0] + state.current_state[1]) % 2}`]"
             v-if="screen.type === 'schedule'">
          <div class="obs-intermission-schedule-title" v-if="display !== 'thumbnail'">
            {{ state.state.schedule_header }}
          </div>

          <div v-for="entry in state.context.schedule.slice(0, event.template.schedule_length)"
               :class="['obs-intermission-schedule-entry', `obs-intermission-schedule-${entry.type}`, {'no-picture': (entry.type !== 'talk' || !entry.author.picture_url), 'no-author': (entry.type !== 'talk' || entry.authors.length === 0), 'with-start-time': entry.start}, entry.classes]"
               :key="`schedule-el-${entry.lp}`"
          >
            <template v-if="entry.type === 'talk' && entry.authors.length > 0">
              <div class="obs-intermission-schedule-talk-picture" v-if="entry.author.picture_url">
                <img :src="entry.author.picture_url" :alt="entry.author.name">
              </div>
              <div class="obs-intermission-schedule-entry-content">
                <span class="obs-intermission-schedule-entry-start-time" v-if="entry.start">{{ formatTime(entry.start) }}</span>
                <span class="obs-intermission-schedule-talk-author-name">{{ entry.author.name }}</span>
                <span class="obs-intermission-schedule-talk-title">{{ entry.title }}</span>
              </div>
            </template>
            <template v-else>
              <div class="obs-intermission-schedule-entry-content">
                <span class="obs-intermission-schedule-entry-start-time" v-if="entry.start">{{ formatTime(entry.start) }}</span>
                <span class="obs-intermission-schedule-misc-title">{{ entry.title }}</span>
              </div>
            </template>
          </div>

          <div class="obs-intermission-schedule-entry obs-intermission-schedule-overflow" v-if="state.context.schedule.length > event.template.schedule_length">
            <div class="obs-intermission-schedule-entry-content">
              <span class="obs-intermission-schedule-misc-title">And more...</span>
            </div>
          </div>
        </div>

      <!-- Video -->
        <video
          class="obs-intermission-video"
          v-if="screen.type === 'video'"
          :src="screen.url"
          :ref="`video${screen_no}`"
          :id="`screen-${screen_no}-video`"
        ></video>

      <!-- Next -->
        <div class="obs-intermission-next" v-if="screen.type == 'next'">
          <div :class="['obs-intermission-next-entry', `obs-intermission-schedule-${current.type}`, current.classes]"
               :key="`schedule-el-${current.lp}`">
            <template v-if="current.type == 'talk'">
              <div class="obs-intermission-next-entry-picture" v-if="current.author.picture_url">
                <img :src="current.author.picture_url" :alt="current.author.name">
              </div>
              <div class="obs-intermission-next-entry-content">
                <span class="obs-intermission-next-entry-author-name">{{ current.author.name }}</span>
                <span class="obs-intermission-next-entry-title">{{ current.title }}</span>
              </div>
            </template>
            <template v-else-if="current.type == 'lightning-talks'">
              <div class="obs-intermission-next-entry-content">
                <span class="obs-intermission-next-entry-misc-title">Lightning talks</span>
              </div>
            </template>
            <template v-else-if="current.type == 'break' || current.type == 'announcement'">
              <div class="obs-intermission-next-entry-content">
                <span class="obs-intermission-next-entry-misc-title">{{ current.title }}</span>
              </div>
            </template>
          </div>
        </div>

      <!-- Message -->
        <template v-if="displayMessagesFor(screen.type) && display == 'scene'">
          <div :class="['obs-intermission-info', messagesPositionCls]">{{ state.context.info }}</div>
          <div :class="['obs-intermission-message', messagesPositionCls]">{{ state.context.message }}</div>
        </template>

      <!-- questions integration -->
        <div v-if="displayMessagesFor(screen.type) && display == 'atem' && event.questions_integration" class="obs-intermission-questions-integration">
          <img :src="event.questions_integration.qr_code_url" class="obs-intermission-questions-integration-qr">
          <span class="obs-intermission-questions-integration-text">Ask questions using {{ event.questions_integration.name }}</span>
          <span class="obs-intermission-questions-integration-url" v-if="event.questions_integration.url">{{ event.questions_integration.url }}</span>
        </div>

      <!-- presentation-title -->
        <template v-if="screen.type == 'presentation'">
          <div class="obs-presentation-top-bar">
            <template v-if="current.type == 'talk'">
              <span class="obs-presentation-author">{{ current.author.name }}</span>
              <span class="obs-presentation-title">{{ current.title }}</span>
            </template>
            <template v-else-if="current.type == 'lightning-talks'">
              <span class="obs-presentation-misc-title">Lightning talks</span>
            </template>
            <template v-else-if="current.type == 'break' || current.type == 'announcement'">
              <span class="obs-presentation-misc-title">{{ current.title }}</span>
            </template>
          </div>
          <div :class="['obs-presentation-sponsors', 'slideshow', `obs-presentation-sponsors-${presentationSponsors}`]" v-if="presentationSponsors !== null && event.template.sponsors_on.includes('presentation') && state.context.presentation_sponsors.length > 0">
            <div  :class="['slide', {'active': slideActive(ticker, 5000, index, state.context.presentation_sponsors.length)}]"  v-for="(sponsor, index) in state.context.presentation_sponsors">
              <img :src="sponsor.logo_url" :alt="sponsor.name">
            </div>
          </div>
          <div class="obs-presentation-bottom-bar" v-if="presentationBottomBar">
            <div class="obs-presentation-bottom-bar-slider slideshow">
              <div :class="['slide', {'active': slideActive(ticker, 5000, index, state.context.socials.length)}]" v-for="(social, index) in state.context.socials">
                <span class="obs-presentation-bottom-bar-social-icon" v-if="!social.img">
                  <i v-if="social.type === 'website'" class="fa-solid fa-globe"></i>
                  <i v-else :class="['fa-brands', `fa-${social.type}`]"></i>
                </span>
                <span class="obs-presentation-bottom-bar-social-url">{{ social.url.replace(/^https?:\/\//, "").replace(/\/$/, "") }}</span>
                <span class="obs-presentation-bottom-bar-social-code" v-if="social.code">{{ social.code }}</span>
              </div>
            </div>
          </div>
        </template>
      </div>
    </template>
    {% endraw %}
  </body>
</html>
